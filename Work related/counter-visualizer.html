<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Counter document visualizer</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Custom Scrollbar for the main area */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LL3LWXVBHR"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-LL3LWXVBHR');
    </script>

</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const STORAGE_KEY = 'glados_inspector_data';

        // --- 1. Data Processing Logic ---

        const getEmoji = (key) => {
            const k = key.toLowerCase();
            if (k.includes('dragon')) return 'üêâ';
            if (k.includes('heist') || k.includes('bank')) return 'üè¶';
            if (k.includes('coin') || k.includes('chip') || k.includes('money') || k.includes('usd')) return 'üí∞';
            if (k.includes('spin')) return 'üé∞';
            if (k.includes('vip')) return 'üëë';
            if (k.includes('level')) return 'üÜô';
            if (k.includes('quest') || k.includes('mission')) return 'üìú';
            if (k.includes('album') || k.includes('sticker') || k.includes('pack')) return 'üÉè';
            if (k.includes('ticket')) return 'üéüÔ∏è';
            if (k.includes('token')) return 'ü™ô';
            if (k.includes('time') || k.includes('date') || k.includes('day')) return '‚è≥';
            if (k.includes('bonus') || k.includes('reward') || k.includes('prize')) return 'üéÅ';
            if (k.includes('lock') || k.includes('key')) return 'üîë';
            if (k.includes('ftue')) return 'üéì'; // First Time User Experience
            if (k.includes('segment')) return 'üç∞';
            if (k.includes('purchase') || k.includes('sale')) return 'üõí';
            if (k.includes('chest')) return 'üì¶';
            if (k.includes('math')) return 'üßÆ';
            if (k.includes('target')) return 'üéØ';
            if (k.includes('milestone')) return 'üö©';
            if (k.includes('econ')) return 'üìâ';
            return 'üìä';
        };

        const formatNumber = (num) => {
            if (num === null || num === undefined) return '0';
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toString();
        };

        // NEW: Get user's local timezone string (e.g. GMT+7)
        const getUserTimeZone = () => {
            try {
                return Intl.DateTimeFormat().resolvedOptions().timeZone;
            } catch (e) {
                return 'Local';
            }
        };

        const formatDate = (dateString) => {
            if (!dateString) return 'Never';
            if (dateString.startsWith('2040') || dateString.startsWith('2030')) return '‚àû Future';
            const date = new Date(dateString);
            return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: '2-digit' });
        };

        // UPDATED: Show full local date time
        const formatDateTime = (dateString) => {
            if (!dateString) return 'Never';
            if (dateString.startsWith('2040') || dateString.startsWith('2030')) return '‚àû Future';
            const date = new Date(dateString);
            return date.toLocaleString(undefined, { 
                month: 'short', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false
            });
        };

        const formatTime = (dateString) => {
            if (!dateString || dateString.startsWith('2040') || dateString.startsWith('2030')) return '--:--';
            const date = new Date(dateString);
            return date.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit', hour12: false });
        };

        // Generalization Logic: Group keys by common prefixes
        const groupData = (counters) => {
            const groups = {};
            
            Object.keys(counters).forEach(key => {
                const parts = key.split('-');
                let groupName = "General";
                let itemName = key;

                // Heuristics for grouping based on the provided JSON structure
                if (key.startsWith('CT-')) {
                    if (parts[1] === 'Event') {
                        groupName = parts.slice(1, 4).join(' '); // e.g. Event Feast Dragon
                        itemName = parts.slice(4).join(' ');
                    } else if (parts.length > 3) {
                        // Standard: CT-Category-SubCategory-Name
                        groupName = parts.slice(1, 3).join(' ');
                        itemName = parts.slice(3).join(' ');
                    } else {
                        groupName = parts[1];
                        itemName = parts.slice(2).join(' ');
                    }
                }

                groupName = groupName.replace(/([A-Z])/g, ' $1').trim();
                itemName = itemName.replace(/_/g, ' ').replace(/-/g, ' ');

                if (!groups[groupName]) groups[groupName] = [];
                
                groups[groupName].push({
                    id: key,
                    name: itemName,
                    originalGroup: groupName,
                    data: counters[key],
                    emoji: getEmoji(key)
                });
            });

            return groups;
        };

        const getTimelineBuckets = (flatItems) => {
            const buckets = {
                'Future / Never': [],
                'Today': [],
                'Yesterday': [],
                'This Week': [],
                'Older': []
            };

            const now = new Date();
            // Reset to start of day for accurate day comparisons
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterdayStart = new Date(todayStart);
            yesterdayStart.setDate(yesterdayStart.getDate() - 1);
            const weekStart = new Date(todayStart);
            weekStart.setDate(weekStart.getDate() - 7);

            flatItems.forEach(item => {
                const dateStr = item.data.lud;
                if (!dateStr || dateStr.startsWith('2040') || dateStr.startsWith('2030')) {
                    buckets['Future / Never'].push(item);
                    return;
                }

                const d = new Date(dateStr);
                if (d >= todayStart) {
                    buckets['Today'].push(item);
                } else if (d >= yesterdayStart) {
                    buckets['Yesterday'].push(item);
                } else if (d >= weekStart) {
                    buckets['This Week'].push(item);
                } else {
                    buckets['Older'].push(item);
                }
            });

            // Remove empty buckets and sort items within buckets by time desc
            const result = [];
            Object.keys(buckets).forEach(key => {
                if (buckets[key].length > 0) {
                    buckets[key].sort((a, b) => new Date(b.data.lud) - new Date(a.data.lud));
                    result.push({ title: key, items: buckets[key] });
                }
            });

            return result;
        };

        // --- 2. Components ---

        const ArrayVisualizer = ({ data }) => {
            return (
                 <div className="mt-3 bg-slate-900 p-2 rounded text-[10px] font-mono overflow-x-auto border border-slate-700/50">
                    {data.cs && (
                        <div className="mb-2">
                            <div className="text-slate-400 mb-1 flex items-center gap-1">
                                <span className="w-1 h-1 bg-blue-500 rounded-full"></span> Current State (CS)
                            </div>
                            <div className="flex gap-1 flex-wrap">
                                {data.cs.map((val, idx) => (
                                    <span key={idx} className={`px-1.5 py-0.5 rounded text-center min-w-[20px] ${val > 0 ? 'bg-blue-900/50 text-blue-200 border border-blue-800' : 'bg-slate-800 text-slate-500 border border-slate-700'}`}>
                                        {val}
                                    </span>
                                ))}
                            </div>
                        </div>
                    )}
                    {data.mcs && (
                        <div>
                            <div className="text-slate-400 mb-1 flex items-center gap-1">
                                <span className="w-1 h-1 bg-purple-500 rounded-full"></span> Max State (MCS)
                            </div>
                            <div className="flex gap-1 flex-wrap">
                                {data.mcs.map((val, idx) => (
                                    <span key={idx} className="px-1.5 py-0.5 bg-slate-800 text-slate-500 border border-slate-700 rounded text-center min-w-[20px]">
                                        {val === null ? 'null' : val}
                                    </span>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            )
        }

        const StatCard = ({ item, isTimeline = false }) => {
            const { name, data, emoji, originalGroup } = item;
            const [expanded, setExpanded] = useState(false);

            const hasArrays = (data.cs && data.cs.length > 0) || (data.mcs && data.mcs.length > 0);
            
            let valColor = "text-white";
            if (data.c === 0) valColor = "text-slate-500";
            if (data.c < 0) valColor = "text-red-400";
            if (data.c > 1000000) valColor = "text-emerald-400";

            // Tooltip helper
            const getTooltip = (dateStr) => {
                if (!dateStr || dateStr.startsWith('2040')) return '';
                const date = new Date(dateStr);
                return `Local: ${date.toString()}\nUTC: ${date.toUTCString()}`;
            };

            if (isTimeline) {
                return (
                    <div className="relative pl-8 pb-8 last:pb-0">
                        {/* Timeline Connector */}
                        <div className="absolute left-[11px] top-6 bottom-0 w-px bg-slate-800"></div>
                        <div className="absolute left-0 top-1.5 w-6 h-6 rounded-full bg-slate-800 border-2 border-slate-700 flex items-center justify-center text-xs z-10 shadow-sm">
                            {emoji}
                        </div>

                        <div className="bg-slate-800/50 border border-slate-700/50 rounded-lg p-3 hover:border-blue-500/50 hover:bg-slate-800 transition-all">
                            <div className="flex justify-between items-start">
                                <div>
                                    <div className="flex items-center gap-2 mb-1">
                                        <span 
                                            className="text-blue-200 font-mono text-xs font-bold bg-blue-900/30 px-1.5 py-0.5 rounded cursor-help"
                                            title={getTooltip(data.lud)}
                                        >
                                            {formatTime(data.lud)}
                                        </span>
                                        <span className="text-xs text-slate-500 uppercase tracking-wide">{originalGroup}</span>
                                    </div>
                                    <h4 className="text-sm font-medium text-slate-200">{name}</h4>
                                </div>
                                <div className={`text-xl font-bold font-mono ${valColor}`}>
                                    {formatNumber(data.c)}
                                </div>
                            </div>
                            
                            {/* Metadata Row */}
                            <div className="mt-2 flex items-center gap-4 text-[10px] text-slate-500">
                                <span className="cursor-help border-b border-dotted border-slate-700" title={getTooltip(data.lud)}>Updated: {formatDate(data.lud)}</span>
                                {data.lcd && !data.lcd.startsWith('2040') && (
                                    <span>Expires: {formatDate(data.lcd)}</span>
                                )}
                                {hasArrays && (
                                    <button 
                                        onClick={() => setExpanded(!expanded)}
                                        className="text-blue-400 hover:text-blue-300 font-semibold"
                                    >
                                        {expanded ? 'Hide Details' : 'View Data'}
                                    </button>
                                )}
                            </div>

                            {expanded && hasArrays && <ArrayVisualizer data={data} />}
                        </div>
                    </div>
                );
            }

            // Dashboard Card Style
            return (
                <div className="bg-slate-800 border border-slate-700 rounded-lg p-4 hover:border-blue-500 transition-colors shadow-sm flex flex-col justify-between h-full">
                    <div>
                        <div className="flex items-start justify-between mb-2">
                            <span className="text-2xl mr-2 filter drop-shadow-md">{emoji}</span>
                            <span className="text-xs font-mono text-slate-400 break-all text-right leading-tight">{name}</span>
                        </div>
                        
                        <div className={`text-2xl font-bold font-mono ${valColor} mb-1`}>
                            {formatNumber(data.c)}
                        </div>
                        <div className="text-xs text-slate-500 font-mono">
                           Raw: {data.c.toLocaleString()}
                        </div>
                    </div>

                    <div className="mt-4 pt-3 border-t border-slate-700/50 flex flex-col gap-1">
                        <div className="flex justify-between text-[10px] text-slate-400">
                            <span>Last Upd:</span>
                            <span className="font-mono text-blue-100 cursor-help border-b border-dotted border-slate-600" title={getTooltip(data.lud)}>
                                {formatDateTime(data.lud)}
                            </span>
                        </div>
                        <div className="flex justify-between text-[10px] text-slate-500">
                            <span>Expires:</span>
                            <span className="cursor-help" title={getTooltip(data.lcd)}>{formatDate(data.lcd)}</span>
                        </div>
                        
                        {hasArrays && (
                            <button 
                                onClick={() => setExpanded(!expanded)}
                                className="mt-2 text-[10px] uppercase tracking-wider font-bold text-blue-400 hover:text-blue-300 text-left"
                            >
                                {expanded ? 'Hide Arrays' : 'Show Arrays'}
                            </button>
                        )}
                    </div>

                    {expanded && hasArrays && <ArrayVisualizer data={data} />}
                </div>
            );
        };

        const TimelineView = ({ data }) => {
            // Flatten data
            const allItems = useMemo(() => {
                const flat = [];
                Object.values(data).forEach(group => {
                    flat.push(...group);
                });
                return flat;
            }, [data]);

            const buckets = useMemo(() => getTimelineBuckets(allItems), [allItems]);

            return (
                <div className="max-w-3xl mx-auto">
                    {buckets.map((bucket, idx) => (
                        <div key={idx} className="mb-8 animate-fade-in">
                            <div className="sticky top-16 z-20 bg-slate-900/95 backdrop-blur py-2 mb-4 border-b border-slate-800">
                                <h3 className="text-blue-400 font-bold text-sm uppercase tracking-widest flex items-center gap-2">
                                    <span className="w-2 h-2 rounded-full bg-blue-500"></span>
                                    {bucket.title}
                                </h3>
                            </div>
                            <div className="space-y-1">
                                {bucket.items.map(item => (
                                    <StatCard key={item.id} item={item} isTimeline={true} />
                                ))}
                            </div>
                        </div>
                    ))}
                     {buckets.length === 0 && (
                        <div className="text-center text-slate-500 py-10">
                            No timed data found.
                        </div>
                    )}
                </div>
            );
        };

        const GroupSection = ({ title, items, isCollapsed, toggleCollapse }) => {
            if (items.length === 0) return null;

            return (
                <div className="mb-8 animate-fade-in">
                    <div 
                        className="flex items-center gap-2 mb-4 cursor-pointer group select-none"
                        onClick={toggleCollapse}
                    >
                        <h2 className="text-xl font-bold text-blue-100 group-hover:text-blue-400 transition-colors">
                            {title}
                        </h2>
                        <span className="bg-slate-700 text-slate-300 text-xs px-2 py-0.5 rounded-full">
                            {items.length}
                        </span>
                        <div className="h-px bg-slate-700 flex-grow ml-4"></div>
                        <span className="text-slate-500 text-sm">
                            {isCollapsed ? 'Show ‚ñº' : 'Hide ‚ñ≤'}
                        </span>
                    </div>
                    
                    {!isCollapsed && (
                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
                            {items.map(item => (
                                <StatCard key={item.id} item={item} />
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const RawInput = ({ value, onChange, onClose }) => {
            return (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm">
                    <div className="bg-slate-900 w-full max-w-4xl h-[80vh] rounded-xl border border-slate-700 flex flex-col shadow-2xl">
                        <div className="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/50 rounded-t-xl">
                            <div>
                                <h3 className="font-bold text-lg text-white">Paste Couchbase Document JSON</h3>
                                <p className="text-xs text-slate-400 font-mono mt-1">Note: document key should be <span className="text-blue-400">mx:ct:&lt;psaid&gt;</span></p>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white px-3 py-1 rounded hover:bg-slate-700 transition-colors">
                                Close & Visualize
                            </button>
                        </div>
                        <textarea
                            className="flex-grow bg-slate-950 text-green-400 font-mono text-xs p-4 focus:outline-none resize-none"
                            value={value}
                            onChange={(e) => onChange(e.target.value)}
                            placeholder='{ "_t": "ct", ... }'
                        />
                    </div>
                </div>
            );
        };

        // --- 3. Main App ---

        const App = () => {
            const [jsonInput, setJsonInput] = useState("");
            const [parsedData, setParsedData] = useState(null);
            const [error, setError] = useState(null);
            const [showInput, setShowInput] = useState(false);
            const [searchTerm, setSearchTerm] = useState("");
            const [collapsedGroups, setCollapsedGroups] = useState({});
            const [viewMode, setViewMode] = useState('dashboard'); // 'dashboard' | 'timeline'
            const [userTimeZone, setUserTimeZone] = useState('');

            // Load default data provided in prompt
            useEffect(() => {
                setUserTimeZone(getUserTimeZone());
                const savedData = localStorage.getItem(STORAGE_KEY);
                
                if (savedData) {
                    setJsonInput(savedData);
                    tryParse(savedData, false); // don't save again if just loading
                } else {
                    const defaultData = `{
  "_t": "ct",
  "lcd": "2025-11-19T20:10:42.4754585Z",
  "c": {
    "CT-Evergreen-Econ-CTierActual": { "lud": "2025-11-20T11:19:36.4909698Z", "lcd": "2040-01-01T00:00:00Z", "c": 10 },
    "CT-Evergreen-Econ-PurchasedToday": { "lud": "2025-11-20T11:19:36.4909698Z", "lcd": "2040-01-01T00:00:00Z", "c": 0 },
    "CT-MyVegasQuest-V1-HyperLite-FTUE-Difficulty": { "lud": "2024-11-07T12:55:35.8020826Z", "lcd": "2040-12-01T08:00:00Z", "c": 1 },
    "CT-Album-V2-Season-Sticker-CollectedStickersFiveStarPercent": { "lud": "2025-11-17T12:50:20.5607083Z", "lcd": "2026-01-19T08:00:00Z", "c": 0, "sik": "202511170800" },
    "CT-Album-V2-Math-CI60D": { "lud": "2025-11-17T12:50:20.5607083Z", "lcd": "2026-01-19T08:00:00Z", "c": 22721716220, "sik": "202511170800" },
    "CT-MissionChase-V3-CurrentMissionPoints": { "lud": "2025-11-20T11:24:36.9047957Z", "lcd": "2025-12-01T08:00:00Z", "c": 285, "sik": "202511170800" },
    "CT-VegasBankHeist-V1-20251117-Total-Coin-In": { "lud": "2025-11-20T11:26:33.3588615Z", "lcd": "2025-11-24T08:00:00Z", "c": 503700000, "sik": "202511170800" },
    "CT-Event-Feast-Dragon-V2-EventCoinIN": { "lud": "2025-11-17T12:50:35.3429806Z", "lcd": "2025-11-22T08:00:00Z", "c": 1703863751, "sik": "202511170800" },
    "CT-LightningWheel-V2-Zorro-VIPTier": { "lud": "2025-11-19T20:10:42.4754585Z", "lcd": "2025-11-20T08:00:00Z", "c": 2, "sik": "202511190800" }
  }
}`; 
                    setJsonInput(defaultData);
                    tryParse(defaultData, false);
                }
            }, []);

            const tryParse = (txt, shouldSave = true) => {
                try {
                    const parsed = JSON.parse(txt);
                    if(parsed.c) {
                        setParsedData(groupData(parsed.c));
                        setError(null);
                        if (shouldSave) {
                            localStorage.setItem(STORAGE_KEY, txt);
                        }
                    } else {
                        setError("Invalid format: Missing 'c' key in root object.");
                    }
                } catch (e) {
                    setError("Invalid JSON format. Please check your syntax.");
                }
            };

            const handleInputChange = (val) => {
                setJsonInput(val);
                tryParse(val, true);
            };

            const toggleGroup = (groupName) => {
                setCollapsedGroups(prev => ({
                    ...prev,
                    [groupName]: !prev[groupName]
                }));
            };

            const filteredGroups = useMemo(() => {
                if (!parsedData) return {};
                if (!searchTerm) return parsedData;

                const filtered = {};
                Object.keys(parsedData).forEach(group => {
                    const matches = parsedData[group].filter(item => 
                        item.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                        group.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                    if (matches.length > 0) {
                        filtered[group] = matches;
                    }
                });
                return filtered;
            }, [parsedData, searchTerm]);

            return (
                <div className="min-h-screen pb-12">
                    {/* Header */}
                    <header className="bg-slate-900 border-b border-slate-800 sticky top-0 z-30 shadow-lg">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="text-3xl">üìä</div>
                                <div>
                                    <div className="flex items-center gap-2">
                                        <h1 className="font-bold text-white leading-none">Counter Inspector</h1>
                                        <span className="text-[10px] bg-slate-800 text-blue-300 px-1.5 py-0.5 rounded border border-slate-700" title="Detected Local Timezone">
                                            {userTimeZone}
                                        </span>
                                    </div>
                                    <span className="text-xs text-slate-500 font-mono">Document Visualizer</span>
                                </div>
                            </div>

                            {/* Center: View Switcher */}
                            <div className="hidden md:flex bg-slate-800 rounded-lg p-1 border border-slate-700">
                                <button 
                                    onClick={() => setViewMode('dashboard')}
                                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'dashboard' ? 'bg-blue-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Dashboard
                                </button>
                                <button 
                                    onClick={() => setViewMode('timeline')}
                                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'timeline' ? 'bg-blue-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Timeline
                                </button>
                            </div>

                            <div className="flex items-center gap-4">
                                <div className="relative hidden lg:block">
                                    <input 
                                        type="text" 
                                        placeholder="Filter keys..." 
                                        className="bg-slate-800 text-sm text-white px-4 py-2 pl-10 rounded-full border border-slate-700 focus:border-blue-500 focus:outline-none w-64 transition-all"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    <span className="absolute left-3 top-2.5 text-slate-500">üîç</span>
                                </div>
                                <button 
                                    onClick={() => setShowInput(true)}
                                    className="bg-slate-800 hover:bg-slate-700 text-white text-sm font-semibold px-4 py-2 rounded-lg border border-slate-700 transition-colors"
                                >
                                    Paste JSON
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Mobile View Switcher */}
                    <div className="md:hidden px-4 pt-4">
                         <div className="flex bg-slate-800 rounded-lg p-1 border border-slate-700 w-full">
                                <button 
                                    onClick={() => setViewMode('dashboard')}
                                    className={`flex-1 px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'dashboard' ? 'bg-blue-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Dashboard
                                </button>
                                <button 
                                    onClick={() => setViewMode('timeline')}
                                    className={`flex-1 px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'timeline' ? 'bg-blue-600 text-white shadow' : 'text-slate-400 hover:text-white'}`}
                                >
                                    Timeline
                                </button>
                            </div>
                    </div>

                    {/* Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {error && (
                            <div className="bg-red-900/50 border border-red-500/50 text-red-200 p-4 rounded-lg mb-6 text-center">
                                {error}
                            </div>
                        )}

                        {!parsedData && !error && (
                            <div className="text-center text-slate-500 mt-20">
                                <div className="text-6xl mb-4">üì•</div>
                                <p>No data loaded.</p>
                                <p className="text-sm">Click "Paste JSON" to visualize your Couchbase document.</p>
                            </div>
                        )}

                        {parsedData && Object.keys(filteredGroups).length === 0 && (
                            <div className="text-center text-slate-500 mt-20">
                                <p>No matches found for "{searchTerm}"</p>
                            </div>
                        )}

                        {parsedData && viewMode === 'dashboard' && Object.keys(filteredGroups).map(groupName => (
                            <GroupSection 
                                key={groupName} 
                                title={groupName} 
                                items={filteredGroups[groupName]} 
                                isCollapsed={!!collapsedGroups[groupName]}
                                toggleCollapse={() => toggleGroup(groupName)}
                            />
                        ))}

                        {parsedData && viewMode === 'timeline' && (
                            <TimelineView data={filteredGroups} />
                        )}

                    </main>

                    {/* Modals */}
                    {showInput && (
                        <RawInput 
                            value={jsonInput} 
                            onChange={handleInputChange} 
                            onClose={() => setShowInput(false)} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>