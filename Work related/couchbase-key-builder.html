<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Couchbase Document Key Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-8">
                Couchbase Document Key Builder
            </h1>
            
            <!-- Environment Selection -->
            <div class="mb-6">
                <label for="environment" class="block text-sm font-medium text-gray-700 mb-2">Environment</label>
                <select id="environment" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    <option value="">Select Environment</option>
                    <option value="trunk" data-prefix="mxhk">Trunk (mxhk:)</option>
                    <option value="qa" data-prefix="mxqa">QA (mxqa:)</option>
                    <option value="prod" data-prefix="mx">Production (mx:)</option>
                </select>
            </div>

            <!-- Document Type Selection -->
            <div class="mb-6">
                <label for="docType" class="block text-sm font-medium text-gray-700 mb-2">Document Type</label>
                <select id="docType" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    <option value="">Select Document Type</option>
                    <optgroup label="Player Documents">
                        <option value="s" data-params="psaId">Player Saga (s:psaId)</option>
                        <option value="sz" data-params="psaId,sagaZoneId">Player Saga Zone (sz:psaId:sagaZoneId)</option>
                        <option value="q" data-params="psaId,questId">Player Quest (q:psaId:questId)</option>
                        <option value="qc" data-params="psaId,questCampaignId">Player Quest Campaign (qc:psaId:questCampaignId)</option>
                        <option value="qs" data-params="psaId">Player Quest States (qs:psaId)</option>
                        <option value="ct" data-params="psaId">Player Counters (ct:psaId)</option>
                        <option value="co" data-params="psaId">Player Consumables (co:psaId)</option>
                        <option value="se" data-params="psaId">Player Seasons (se:psaId)</option>
                        <option value="c" data-params="psaId">Collections (c:psaId)</option>
                        <option value="sm" data-params="psaId">Spin Meta (sm:psaId)</option>
                        <option value="pb" data-params="psaId">Purchase Bonus (pb:psaId)</option>
                        <option value="mvq" data-params="psaId">MyVegas Quest (mvq:psaId)</option>
                        <option value="pcheats" data-params="psaId">Player Cheats (pcheats:psaId)</option>
                        <option value="PlayerCampaign" data-params="psaId">Player Campaign (PlayerCampaign:psaId)</option>
                        <option value="pc" data-params="psaId">Daily Bonus Game State (pc:psaId)</option>
                        <option value="pi" data-params="psaId">Player Inbox (pi:psaId)</option>
                        <option value="ls" data-params="psaId">Leaderboard State (ls:psaId)</option>
                        <option value="pg" data-params="psaId">Player Gifts (pg:psaId)</option>
                        <option value="in" data-params="psaId">Inventory (in:psaId)</option>
                    </optgroup>
                    <optgroup label="Album Documents">
                        <option value="alp" data-params="psaId">Album Progress (alp:psaId)</option>
                        <option value="alpv2" data-params="psaId">Album Progress V2 (alpv2:psaId)</option>
                        <option value="alrb" data-params="psaId">Album Reward Booster (alrb:psaId)</option>
                        <option value="albums" data-params="psaId,albumId">Player Albums (albums:psaId:albumId)</option>
                    </optgroup>
                    <optgroup label="Glados Documents">
                        <option value="g2:pa" data-params="psaId">Glados2 Preview Award (g2:pa:psaId)</option>
                        <option value="g2i" data-params="psaId">Glados2 Index (g2i:psaId)</option>
                        <option value="g2" data-params="system,psaId">Glados2 (g2:system:psaId)</option>
                    </optgroup>
                    <optgroup label="Other Documents">
                        <option value="si" data-params="scheduleId,psaId">Schedule Instance (si:scheduleId:psaId)</option>
                        <option value="gctm" data-params="counterId">Global Counter Meta (gctm:counterId)</option>
                        <option value="gs" data-params="sessionId">Player Gifts Sent (gs:sessionId)</option>
                    </optgroup>
                </select>
            </div>

            <!-- Dynamic Parameter Inputs -->
            <div id="parameterInputs" class="space-y-4 mb-6">
                <!-- Dynamic inputs will be generated here -->
            </div>

            <!-- Result Section -->
            <div id="resultSection" class="mb-6">
                <div class="bg-gray-50 rounded-lg p-6 border">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Generated Document Key</h3>
                    <div class="bg-white p-4 rounded border font-mono text-lg break-all min-h-[3rem] flex items-center" id="generatedKey">
                        <span class="text-gray-400 italic">Select environment and document type to generate key</span>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button id="copyBtn" class="bg-secondary text-white px-4 py-2 rounded hover:bg-secondary/90 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Copy to Clipboard
                        </button>
                        <button id="clearBtn" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition-colors duration-200">
                            Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Key Structure Info -->
            <div class="bg-blue-50 rounded-lg p-6 border border-blue-200">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">Key Structure Information</h3>
                <div class="text-sm text-blue-700 space-y-2">
                    <p><strong>Format:</strong> [environment_prefix]:[document_type_key]</p>
                    <p><strong>Environment Prefixes:</strong></p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li><code class="bg-blue-100 px-1 rounded">mxhk:</code> - Trunk environment</li>
                        <li><code class="bg-blue-100 px-1 rounded">mxqa:</code> - QA environment</li>
                        <li><code class="bg-blue-100 px-1 rounded">mx:</code> - Production environment</li>
                    </ul>
                    <p><strong>Example:</strong> <code class="bg-blue-100 px-1 rounded">mxhk:s:12345</code> (Trunk environment, Player Saga document for PSA ID 12345)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class CouchbaseKeyBuilder {
            constructor() {
                this.selectedPrefix = null;
                this.initializeEventListeners();
                this.loadSavedValues();
            }

            initializeEventListeners() {
                // Environment selection
                document.getElementById('environment').addEventListener('change', (e) => this.handleEnvironmentChange(e));

                // Document type selection
                document.getElementById('docType').addEventListener('change', (e) => this.handleDocTypeChange(e));

                // Copy button
                document.getElementById('copyBtn').addEventListener('click', () => this.copyToClipboard());

                // Clear button
                document.getElementById('clearBtn').addEventListener('click', () => this.clearForm());
            }

            handleEnvironmentChange(e) {
                const selectedOption = e.target.selectedOptions[0];
                this.selectedPrefix = selectedOption.dataset.prefix || null;
                this.saveValues();
                this.generateKey();
            }

            handleDocTypeChange(e) {
                const selectedOption = e.target.selectedOptions[0];
                const params = selectedOption.dataset.params;
                
                this.generateParameterInputs(params);
                this.saveValues();
                this.generateKey();
            }

            generateParameterInputs(params) {
                const container = document.getElementById('parameterInputs');
                container.innerHTML = '';

                if (!params) return;

                const paramList = params.split(',');
                paramList.forEach(param => {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label for="${param}" class="block text-sm font-medium text-gray-700 mb-2">${this.formatParamLabel(param)}</label>
                        <input type="text" id="${param}" name="${param}" 
                               class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Enter ${param}">
                    `;
                    container.appendChild(div);

                    // Add event listener for input changes
                    const input = div.querySelector('input');
                    input.addEventListener('input', () => {
                        this.saveValues();
                        this.generateKey();
                    });
                });

                // Load saved parameter values
                this.loadParameterValues();
            }

            formatParamLabel(param) {
                const labels = {
                    'psaId': 'PSA ID',
                    'sagaZoneId': 'Saga Zone ID',
                    'questId': 'Quest ID',
                    'questCampaignId': 'Quest Campaign ID',
                    'albumId': 'Album ID',
                    'scheduleId': 'Schedule ID',
                    'counterId': 'Counter ID',
                    'sessionId': 'Session ID',
                    'system': 'System'
                };
                return labels[param] || param;
            }

            generateKey() {
                const environment = document.getElementById('environment').value;
                const docType = document.getElementById('docType').value;
                const paramInputs = document.querySelectorAll('#parameterInputs input');
                const keyDisplay = document.getElementById('generatedKey');
                const copyBtn = document.getElementById('copyBtn');
                
                // Check if we have minimum requirements
                if (!environment || !docType) {
                    keyDisplay.innerHTML = '<span class="text-gray-400 italic">Select environment and document type to generate key</span>';
                    copyBtn.disabled = true;
                    return;
                }

                // Check if all required parameters are filled
                const allParamsFilled = Array.from(paramInputs).every(input => input.value.trim() !== '');
                if (paramInputs.length > 0 && !allParamsFilled) {
                    keyDisplay.innerHTML = '<span class="text-gray-400 italic">Fill in all parameters to generate key</span>';
                    copyBtn.disabled = true;
                    return;
                }

                // Generate the key
                let keyParts = [docType];
                paramInputs.forEach(input => {
                    keyParts.push(input.value.trim());
                });
                
                const documentKey = keyParts.join(':');
                const fullKey = `${this.selectedPrefix}:${documentKey}`;
                
                keyDisplay.textContent = fullKey;
                copyBtn.disabled = false;
            }

            copyToClipboard() {
                const keyText = document.getElementById('generatedKey').textContent;
                if (keyText && !keyText.includes('Select') && !keyText.includes('Fill')) {
                    navigator.clipboard.writeText(keyText).then(() => {
                        const btn = document.getElementById('copyBtn');
                        const originalText = btn.textContent;
                        btn.textContent = 'Copied!';
                        btn.classList.remove('bg-secondary');
                        btn.classList.add('bg-green-500');
                        
                        setTimeout(() => {
                            btn.textContent = originalText;
                            btn.classList.remove('bg-green-500');
                            btn.classList.add('bg-secondary');
                        }, 2000);
                    });
                }
            }

            clearForm() {
                // Clear form fields
                document.getElementById('environment').value = '';
                document.getElementById('docType').value = '';
                document.getElementById('parameterInputs').innerHTML = '';
                
                const keyDisplay = document.getElementById('generatedKey');
                keyDisplay.innerHTML = '<span class="text-gray-400 italic">Select environment and document type to generate key</span>';
                
                document.getElementById('copyBtn').disabled = true;
                
                this.selectedPrefix = null;
                
                // Clear localStorage
                localStorage.removeItem('couchbaseKeyBuilder');
            }

            saveValues() {
                const data = {
                    environment: document.getElementById('environment').value,
                    docType: document.getElementById('docType').value,
                    parameters: {}
                };

                // Save parameter values
                document.querySelectorAll('#parameterInputs input').forEach(input => {
                    data.parameters[input.name] = input.value;
                });

                localStorage.setItem('couchbaseKeyBuilder', JSON.stringify(data));
            }

            loadSavedValues() {
                const saved = localStorage.getItem('couchbaseKeyBuilder');
                if (!saved) return;

                try {
                    const data = JSON.parse(saved);
                    
                    // Restore environment selection
                    if (data.environment) {
                        document.getElementById('environment').value = data.environment;
                        const event = new Event('change');
                        document.getElementById('environment').dispatchEvent(event);
                    }

                    // Restore document type
                    if (data.docType) {
                        document.getElementById('docType').value = data.docType;
                        const event = new Event('change');
                        document.getElementById('docType').dispatchEvent(event);
                    }

                    // Restore parameters will be handled by loadParameterValues
                    this.savedParameters = data.parameters || {};
                } catch (e) {
                    console.error('Error loading saved values:', e);
                }
            }

            loadParameterValues() {
                if (!this.savedParameters) return;

                Object.entries(this.savedParameters).forEach(([name, value]) => {
                    const input = document.getElementById(name);
                    if (input) {
                        input.value = value;
                    }
                });

                this.generateKey();
            }
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new CouchbaseKeyBuilder();
        });
    </script>
</body>
</html>